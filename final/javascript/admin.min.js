$(document).ready(function(){function e(){let e=$("#newAdmin"),i=e.find("#password").val(),n=e.find("#username").val(),o=e.find("#email").val(),a=e.find("#confirm").val();return $.ajax({type:"POST",url:BASE_URL+"api/admin/add_admin.php",data:{username:n,password:i,email:o,confirm:a,token:token,adminId:adminId},dataType:"json",success:function(i){e.find(".field_error.username").text(""),e.find(".field_error.email").text("");let n=i.message,o=i.response;n.includes("Invalid username characters.")||n.includes("Username already exists.")?e.find(".field_error.username").text(n):n.includes("Email already exists.")?e.find(".field_error.email").text(n):($.magnificPopup.open({items:{src:'<div class="white-popup">'+n+"</div>",type:"inline"}}),o.includes("Success")&&e.trigger("reset"))},error:function(e){console.log(e)}}),!1}function i(){event.preventDefault();let e=$("#newCategory"),i=e.find("input[name='title']").val(),n=$.ajax({type:"POST",url:BASE_URL+"api/admin/add_category.php",data:{title:i,token:token,adminId:adminId},dataType:"json"});n.done(function(n,o,a){let t=n.message,s=n.response;if(t.includes("Category already exists"))e.find(".field_error").text(t);else if(s.includes("Success")){e.trigger("reset");let o='<li class="list-group-item col-md-3">'+i+'<a class="removeCategoryPopup id-'+n.id+'" href="#removeCategoryConfirmation"><i class="fa fa-times pull-right" aria-hidden="true"></i></a></li>';$(".categories ul").append(o).fadeIn(1e3)}else $.magnificPopup.open({items:{src:'<div class="white-popup">'+t+"</div>",type:"inline"}})}),n.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}function n(e,i){$.magnificPopup.close();let n;(n=$.ajax({type:"POST",url:BASE_URL+"api/admin/remove_category.php",data:{id:e,token:token,adminId:adminId},dataType:"json"})).done(function(e,n,o){let a=e.message;e.response.includes("Success")?i.hide("slow",function(){i.remove()}):$.magnificPopup.open({items:{src:'<div class="white-popup">'+a+"</div>",type:"inline"}})}),n.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}function o(e){let i;(i=$.ajax({type:"POST",url:BASE_URL+"api/admin/remove_auction.php",data:{id:e,token:token,adminId:adminId},dataType:"json"})).done(function(e,i,n){let o=e.message,a=e.response;$.magnificPopup.open({items:{src:'<div class="white-popup">'+o+"</div>",type:"inline"}}),a.includes("Success")&&d.DataTable().row(".selected").remove().draw(!1)}),i.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}function a(e){let i;(i=$.ajax({type:"POST",url:BASE_URL+"api/admin/remove_user.php",data:{id:e,token:token,adminId:adminId},dataType:"json"})).done(function(e,i,n){let o=e.message,a=e.response;$.magnificPopup.open({items:{src:'<div class="white-popup">'+o+"</div>",type:"inline"}}),a.includes("Success")&&c.DataTable().row(".selected").remove().draw(!1)}),i.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}function t(e,i){let n;(n=$.ajax({type:"POST",url:BASE_URL+"api/admin/remove_report.php",data:{id:e,type:i,token:token,adminId:adminId},dataType:"json"})).done(function(e,i,n){let o=e.message,a=e.response;$.magnificPopup.open({items:{src:'<div class="white-popup">'+o+"</div>",type:"inline"}}),a.includes("Success")&&l.DataTable().row(".selected").remove().draw(!1)}),n.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}function s(){$.magnificPopup.close();let e,i=$("#usersTable").find("tr.selected").find("td:first").html(),n=$("#notificationForm").find("textarea#notification").val();(e=$.ajax({type:"POST",url:BASE_URL+"api/admin/notify_user.php",data:{id:i,message:n,token:token,adminId:adminId},dataType:"json"})).done(function(e,i,n){let o=e.message,a=e.response;$.magnificPopup.open({items:{src:'<div class="white-popup">'+o+"</div>",type:"inline"}}),a.includes("Success")&&$("#notificationForm").trigger("reset")}),e.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}function r(e,i){$.magnificPopup.close();let n;(n=$.ajax({type:"POST",url:BASE_URL+"api/admin/remove_feedback.php",data:{id:e,token:token,adminId:adminId},dataType:"json"})).done(function(e,n,o){let a=e.message,t=e.response;if($.magnificPopup.open({items:{src:'<div class="white-popup">'+a+"</div>",type:"inline"}}),t.includes("Success")){let e=$("#feedbackDiv"),n=e.children(".notifications-wrapper").length;i.hide("slow",function(){i.remove(),n-1==0&&$("#noFeedback").show()})}}),n.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})}$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")}),$("#newAdmin").validate({rules:{email:{email:!0,required:!0,maxlength:64},username:{required:!0,maxlength:64},password:{required:!0,minlength:8,maxlength:64},confirm:{required:!0,equalTo:$(this).find("#password")}},messages:{username:{required:"Please, enter the admin's username.",maxlength:"The admin's username must be no more than 64 characters."},password:{required:"Please, enter the admin's password.",minlength:"The admin's password should be between 8 and 64 characters.",maxlength:"The admin's password should be between 8 and 64 characters."},confirm:{required:"Please, enter the password confirmation.",equalTo:"The confirmation password does not match."},email:{email:"Please, enter the admin's email.",maxlength:"The admin's email must be no more than 64 characters."}},errorPlacement:function(e,i){let n=$(i).parent(".input-group");e.insertAfter(n)},submitHandler:e}),$("#newCategory").validate({rules:{title:{required:!0,maxlength:64}},submitHandler:i}),$("ul.list-group").on("click","a.removeCategoryPopup",function(){let e=$(this).closest(".list-group-item"),i=$(this).attr("class").split("id-");if(i.length>2)return;let o=i[1];$(".removeCategoryPopup").magnificPopup({type:"inline",midClick:!0,mainClass:"mfp-fade"}).magnificPopup("open"),$(".removeCategory").off(),$(".removeCategory").one("click",function(){$.magnificPopup.close(),n(o,e)})});let d=$("#auctionsTable");d.DataTable();let c=$("#usersTable");c.DataTable();let l=$("#reportsTable");l.DataTable(),$(".removePopup").on("click",function(){let e=d.find("tr.selected").find("td:first").html();void 0!==e&&($(".removePopup").magnificPopup({type:"inline",midClick:!0,mainClass:"mfp-fade"}).magnificPopup("open"),$(".removeAuction").off(),$(".removeAuction").one("click",function(){$.magnificPopup.close(),o(e)}))}),$(".removeUserPopup").on("click",function(){let e=c.find("tr.selected").find("td:first").html();void 0!==e&&($(".removeUserPopup").magnificPopup({type:"inline",midClick:!0,mainClass:"mfp-fade"}).magnificPopup("open"),$(".removeUser").off(),$(".removeUser").one("click",function(){$.magnificPopup.close(),a(e)}))}),$(".notifyUserPopup").on("click",function(){void 0!==c.find("tr.selected").find("td:first").html()&&$(".notifyUserPopup").magnificPopup({type:"inline",midClick:!0,mainClass:"mfp-fade"}).magnificPopup("open")}),$(".removeReportPopup").on("click",function(){let e=l.find("tr.selected").find("td:first").html();if(void 0===e)return;let i=l.find("th.reportType").html();-1!==["Answer","Auction","User","Question"].indexOf(i)&&($(".removeReportPopup").magnificPopup({type:"inline",midClick:!0,mainClass:"mfp-fade"}).magnificPopup("open"),$(".removeReport").off(),$(".removeReport").one("click",function(){$.magnificPopup.close(),t(e,i)}))}),$("#notificationForm").validate({rules:{notification:{required:!0,maxlength:256}},submitHandler:s}),$(".showReports").on("click",function(){let e=$("#report_type").val();e!==$("#reportsTable").find("th.reportType").html()&&window.location.replace(BASE_URL+"pages/admin/reports.php?type="+e)}),$(".closePopup").on("click",function(){$.magnificPopup.close()}),d.find("tbody").on("click","tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):($("#auctionsTable").find("tr.selected").removeClass("selected"),$(this).addClass("selected"))}),c.find("tbody").on("click","tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):($("#usersTable").find("tr.selected").removeClass("selected"),$(this).addClass("selected"))}),l.find("tbody").on("click","tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):($("#reportsTable").find("tr.selected").removeClass("selected"),$(this).addClass("selected"))}),$(".removeFeedbackPopup").on("click",function(){let e=$(this).closest("div.notifications-wrapper"),i=$(this).parent(".media-body").find("h5 span.feed_id").html();$(".removeFeedbackPopup").magnificPopup({type:"inline",midClick:!0,mainClass:"mfp-fade"}).magnificPopup("open"),$(".removeFeedback").off(),$(".removeFeedback").one("click",function(){$.magnificPopup.close(),r(i,e)})}),$(".exportAuctions").on("click",function(){let e;(e=$.ajax({type:"POST",url:BASE_URL+"api/admin/export_auctions.php",data:{token:token,adminId:adminId},dataType:"json"})).done(function(e,i,n){let o=e.message;e.response;$.magnificPopup.open({items:{src:'<div class="white-popup">'+o+"</div>",type:"inline"}})}),e.fail(function(e,i,n){console.error("The following error occurred: "+i,n)})})});